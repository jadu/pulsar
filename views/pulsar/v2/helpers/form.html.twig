{# -----------------------------------------------------------------------------

# Button group

Creates a series of buttons on a single line which are radio or checkbox input
types.

## Example usage

```twig
{{
    form.button_group({
        'label': 'Band',
        'items': [
            form.radio_simple({
                'label': 'AM',
                'name': 'bands'
            }),
            form.radio_simple({
                'label': 'FM',
                'name': 'bands'
            }),
            form.radio_simple({
                'label': 'MW',
                'name': 'bands'

            })
        ]
    })
}}
```

## Options applied to parent wrapper

Option        | Type   | Description
------------- | ------ | -------------------------------------------------------
class         | string | A space separated list of class names
error         | string | Text to explain an error/validation condition. Also adds error state styling
guidance      | string | Text to be displayed in a popover, adds a (?) icon after the input
help          | string | Additional guidance information to be displayed next to the input
label         | string | Text for the `<label>` companion element
required      | bool   | Visually indicates that the field must be completed
show-label    | bool   | Control visibility of the `<label>` element without affecting layout (default: true)

## Options applied to input

Option        | Type   | Description
------------- | ------ | -------------------------------------------------------
items         | array  | An array of items to put in the dropdown list (usually radios)

#}
{% macro button_group(options) %}
{% spaceless %}
    {% import _self as form %}
    {% import '@pulsar/pulsar/v2/helpers/elem.html.twig' as elem %}

    {% set options = modify_options(options|default({})) %}

    {# Build aria-described string of guids for help blocks and errors #}
    {% set describedByIds = [] %}

    {% if options.error_ids is defined and options.error_ids is not empty %}
        {% for id in options.error_ids %}
            {% set describedByIds = describedByIds|merge([id]) %}
        {% endfor %}
    {% endif %}

    {% if options.help_id is defined and options.help_id is not empty %}
        {% set describedByIds = describedByIds|merge([options.help_id]) %}
    {% endif %}

    {% if describedByIds|length %}
        {% set options = options|defaults({'aria-describedby': describedByIds|join(' ')}) %}
    {% endif %}

    {# If error is preset add aria-invalid="true" and aria-describedby to all inputs #}
    {% set items = options.items %}

    {% if options.error is defined and options.error is not empty or options.help is defined and options.help is not empty %}
        {% set tempItems = [] %}
        {% for item in options.items %}
            {% if item is iterable %}
                {% if options.error is defined and options.error %}
                    {% set item = item|merge({ 'has_error': true, 'aria-describedby': describedByIds|join(' ') }) %}
                {% else %}
                    {% set item = item|merge({ 'aria-describedby': describedByIds|join(' ') }) %}
                {% endif %}

                {% set tempItems = tempItems|merge({(loop.index): item}) %}
            {% else %}
                {% set tempItems = options.items %}
            {% endif %}
        {% endfor %}
        {% set items = tempItems %}
    {% endif %}

    {{
        form.group({
            'parent': options
                |only('bare class error error_ids guidance guidance-container has_error help help_id id label required show-label type')
                |merge({'class': options.class|default ~ ' form__button-group'}),
            'controls': {'class': 'btn__group'},
            'inputs': items
        })
    }}
{% endspaceless %}
{% endmacro %}


{# -----------------------------------------------------------------------------

# Checkbox

Generates a checkbox input field.

## Example usage

```twig
{{
    form.checkbox({
        'label': 'Are you awesome?'
    })
}}
```

## Options applied to parent wrapper

Option        | Type   | Description
------------- | ------ | -------------------------------------------------------
class         | string | A space separated list of class names
error         | string | Text to explain an error/validation condition. Also adds error state styling
guidance      | string | Text to be displayed in a popover, adds a (?) icon after the input
help          | string | Additional guidance information to be displayed next to the input
label         | string | Text for the `<label>` companion element
required      | bool   | Visually indicates that the field must be completed
show-label    | bool   | Control visibility of the `<label>` element without affecting layout (default: true)

## Options applied to input

Option        | Type   | Description
------------- | ------ | -------------------------------------------------------
checked       | bool   | Whether the input is checked
form          | string | Specific one or more forms this label belongs to
id            | string | A unique identifier, will also be applied as the label's `for` attribute
indeterminate | bool   | Shows the checkbox as [-], overrides the value of `checked`
name          | string | The name of this control
required      | bool   | Adds `required` and `aria-required="true"` attributes
value         | string | Specifies the value of the input
data-*        | string | Data attributes, eg: `'data-foo': 'bar'`

*Any other options not listed here will be applied to the input.

#}
{% macro checkbox(options) %}
{% spaceless %}
    {% import _self as form %}
    {% import '@pulsar/pulsar/v2/helpers/elem.html.twig' as elem %}

    {% set options = modify_options(options|default({})) %}

    {{
        form.group({
            'parent': options
                |only('bare class error error_ids guidance guidance-container help help_id id label required show-label')
                |defaults({
                    'class': 'form-checkbox'
                }),
            'inputs': [
                elem.input(
                    options
                        |exclude('bare class error guidance guidance-container help label show-label')
                        |defaults({
                            'class': 'checkbox',
                            'type': 'checkbox'
                        })
                )
            ]
        })
    }}

{% endspaceless %}
{% endmacro %}


{# -----------------------------------------------------------------------------

# Checkbox inline

Creates a `<label>` element with a checkbox inside it and allows the checkbox to
be positioned either before or after the label value.

## Example usage

```twig
{{
    form.checkbox_inline({
        'id': 'areYouAwesome',
        'label': 'Are you awesome?',
        'name': 'areYouAwesome'
    })
}}
```

## Options applied to parent wrapper

Option          | Type   | Description
--------------- | ------ | -----------------------------------------------------
class           | string | A space separated list of class names
error           | string | Text to explain an error/validation condition. Also adds error state styling
guidance        | string | Text to be displayed in a popover, adds a (?) icon after the input
help            | string | Additional guidance information to be displayed next to the input
required        | bool   | Visually indicates that the field must be completed

## Options applied to input

Option          | Type   | Description
--------------- | ------ | -----------------------------------------------------
checked         | bool   | Whether the input is checked
form            | string | Specific one or more forms this label belongs to
id              | string | A unique identifier, will also be used as the label's `for` attribute
indeterminate   | bool   | Shows the checkbox as [-], overrides the value of `checked`
input_placement | string | left (default)|right position of the input vs the label value
label           | string | Text for the `<label>` companion element
name            | string | The name of this control
required        | bool   | Adds `required` and `aria-required="true"` attributes
value           | string | Specifies the value of the input
data-*          | string | Data attributes, eg: `'data-foo': 'bar'`

*Any other options not listed here will be applied to the input.

#}
{% macro checkbox_inline(options) %}
{% spaceless %}
    {% import _self as form %}
    {% import '@pulsar/pulsar/v2/helpers/elem.html.twig' as elem %}

    {% if options.help is defined and options.help is not empty %}
        {% set options = options|merge({ 'help_id': 'guid-' ~ random() }) %}
    {% endif %}

    {% set inputClass = 'checkbox' %}
    {%
        if options.bare is defined
        and options.bare
        and options.class is defined
        and options.class is not empty
    %}
        {% set inputClass = inputClass ~ ' ' ~ options.class %}
    {% endif %}

    {%
        set input = elem.input(options
            |exclude('error guidance guidance-container help')
            |merge({
                'class': inputClass,
                'label': null,
                'type': 'checkbox'
            }))
    %}

    {% set label = input ~ options.label %}

    {%
        if options.input_placement is defined
        and options.input_placement == 'right'
    %}
        {% set label = options.label ~ input %}
    {% endif %}

    {{
        form.group({
            'parent': options
                |only('bare class error help help_id id')
                |defaults({
                    'class': 'form-checkbox-inline'
                }),
            'inputs': [
                elem.label({
                    'for': options.id|default,
                    'label': label,
                    'required': options.required|default,
                    'required-indicator': options['required-indicator']|default,
                    'guidance': options.guidance|default,
                    'guidance-container': options['guidance-container']|default
                })
            ]
        })
    }}

{% endspaceless %}
{% endmacro %}

{# -----------------------------------------------------------------------------

# Checkbox Simple

Creates a checkbox input with a sibling label element, this allows other macros
like `form.button_group()` to use the input’s `:checked` state to modify the
label through the use of the sibling `+` CSS selector.

## Example usage

```twig
{{
    form.checkbox_simple({
        'label': 'Foo',
        'name': 'foo_group',
        'id': 'foo'
    })
}}
```

## Example output

```html
<input type="checkbox" name="bar" id="baz" /><label for="baz">Foo</label>
```

## Options applied to input

Option   | Type   | Description
-------- | ------ | ------------------------------------------------------------
form     | string | Specific one or more forms this label belongs to
id       | string | A unique identifier, will also be used as the label's `for` attribute
name     | string | The name of this control
required | bool   | Adds `required` and `aria-required="true"` attributes
selected | bool   | Whether this radio button should be selected
value    | string | Specifies the value of the input
data-*   | string | Data attributes, eg: `'data-foo': 'bar'`

## Options applied to label

Option   | Type   | Description
-------- | ------ | ------------------------------------------------------------
class    | string | A space separated list of class names
label    | string | Text for the `<label>` companion element
required | bool   | Visually indicates that the field must be completed

*Any other options not listed here will be applied to the input

#}
{% macro checkbox_simple(options) %}
{% spaceless %}
    {% import '@pulsar/pulsar/v2/helpers/elem.html.twig' as elem %}

    {{
        elem.input(options
            |exclude('class for guidance-container label show-label')
            |defaults({
                'type': 'checkbox'
            })
            |merge({'class': 'checkbox'})
        )
    }}
    {{
        elem.label(options
            |only('class label for guidance-container required show-label')
            |defaults({'for': options.id|default})
        )
    }}

{% endspaceless %}
{% endmacro %}


{# -----------------------------------------------------------------------------

# Choice

Displayed as a question with multiple answers, each of which has it's own label and can allow either singular (checkboxes) or multiple (radios) choice.

By default, the choice helper will will automatically adhere to Pulsar's form styleguide by switching to a [select2](select2.md) element if more than 5 options are provided.

## Example usage

```twig
{{
    form.choice({
        'label': 'Do you like me?',
        'options': [
            {
                'label': 'Yes',
                'value': '1'
            },
            {
                'No': '0',
                'value': 'No'
            },
            {
                'label': 'Maybe',
                'value': '¯\_(ツ)_/¯'
            }
        ]
    })
}}
```

## Options

Option     | Type   | Description
---------- | ------ | -------------------------------------------------------
class      | string | A space separated list of class names
error      | string | Text to explain an error/validation condition. Also adds error state styling
guidance   | string | Text to be displayed in a popover, adds a (?) icon after the input
help       | string | Additional guidance information to be displayed next to the input
label      | string | Text for the main `<label>` companion element
optimize   | string | `auto` use a select2 element if number of `options` is greater than 5 (default)
                    `few` force the use of checkboxes/radios regardless of the number of options
                    `many` force the use of select2 regardless of the number of options
options    | array  | An array of option hashes that will be passed to the [checkbox](checkbox.md) or  [radio](radio.md) helper, see their documentation for specifics
required   | bool   | Visually indicates that the field must be completed, will not be displayed if `type` is radio as they're implicitly required
multiple   | bool   | If `true`, uses checkboxes instead of radios, or passes the `multiple` attribute to the select2 element
show-label | bool   | Control visibility of the `<label>` element without affecting layout (default: true)

#}
{% macro choice(options) %}
{% spaceless %}
    {% import _self as form %}
    {% import '@pulsar/pulsar/v2/helpers/elem.html.twig' as elem %}

    {% set options = modify_options(options|default({})) %}

    {# Build aria-described string of guids for help blocks and errors #}
    {% set describedByIds = [] %}

    {% if options.error_ids is defined and options.error_ids is not empty %}
        {% for id in options.error_ids %}
            {% set describedByIds = describedByIds|merge([id]) %}
        {% endfor %}
    {% endif %}

    {% if options.help_id is defined and options.help_id is not empty %}
        {% set describedByIds = describedByIds|merge([options.help_id]) %}
    {% endif %}

    {% set inputs = [] %}
    {%
        set options = options|default({})|merge({
            'multiple': options.multiple|default(false),
            'optimize': options.optimize|default('auto')
        })
    %}

    {% if options.optimize == 'many' or (options.options|length > 5 and options.optimize == 'auto') %}

        {% set select_options = {} %}
        {% for select_option in options.options %}
            {%
                set select_options = select_options|merge({
                    (select_option.value): select_option.label
                })
            %}
        {% endfor %}

        {% set select2_options = {
            'bare': true,
            'id': options.id|default,
            'multiple': options.multiple,
            'options': select_options,
            'aria-describedby': describedByIds|join(' ')
        }%}

        {% if options.error is defined and options.error is not empty %}
            {% set select2_options = select2_options|merge({ 'has_error': true }) %}
        {% endif %}

        {%
            set inputs = inputs|merge([
                form.select2(select2_options)
            ])
        %}

    {% else %}

        {% for input_options in options.options %}
            {% set input_options = input_options|merge({
                'bare': true,
                'required-indicator': false,
                'label': '<span class="form-choice__label">' ~ input_options.label ~ '</span>',
                'aria-describedby': describedByIds|join(' ')
            }) %}

            {% if options.error is defined and options.error is not empty %}
                {% set input_options = input_options|merge({ 'has_error': true }) %}
            {% endif %}

            {% if options.required is defined and options.required == true %}
                {% set input_options = input_options|merge({ 'required': true }) %}
            {% endif %}

            {% if options.multiple %}
                {% set inputs = inputs|merge([ form.checkbox_inline(input_options) ]) %}
            {% else %}
                {% set inputs = inputs|merge([ form.radio_inline(input_options) ]) %}
            {% endif %}
        {% endfor %}

    {% endif %}

    {{
        form.group({
            'parent': options
                |only('bare class error error_ids guidance guidance-container help help_id id label required show-label')
                |exclude('multiple')
                |defaults({'class': 'form-choice'}),
            'inputs': inputs
        })
    }}

{% endspaceless %}
{% endmacro %}


{# -----------------------------------------------------------------------------

# Color

Generates a text input with an integrated color picker.

## Example usage

```twig
{{
    form.color({
        'label': 'Background colour'
    })
}}
```

## Options applied to parent wrapper

Option      | Type   | Description
----------- | ------ | ---------------------------------------------------------
class       | string | A space separated list of class names
error       | string | Text to explain an error/validation condition. Also adds error state styling
guidance    | string | Text to be displayed in a popover, adds a (?) icon after the input
help        | string | Additional guidance information to be displayed next to the input
label       | string | Text for the `<label>` companion element
required    | bool   | Visually indicates that the field must be completed
show-label  | bool   | Control visibility of the `<label>` element without affecting layout (default: true)

## Options applied to input

Option      | Type   | Description
----------- | ------ | ---------------------------------------------------------
autofocus   | bool   | Whether the field should have input focus on page load
disabled    | bool   | Stops the element from being interactive if true
form        | string | Specific one or more forms this label belongs to
id          | string | A unique identifier, will also be used as the label's `for` attribute
name        | string | The name of this control
placeholder | string | A short hint that describes the expected value
required    | bool   | Adds `required` and `aria-required="true"` attributes
value       | string | Specifies the value of the input
data-*      | string | Data attributes, eg: `'data-foo': 'bar'`

*Any other options not listed here will be applied to the input.

#}
{% macro color(options) %}
{% spaceless %}
    {% import _self as form %}
    {% import '@pulsar/pulsar/v2/helpers/util.html.twig' as util %}

    {%
        set options = options|default({})|merge({
            'class': options.class|default ~ ' colorpicker js-colorpicker',
            'prepend': options.prepend|default('#'),
            'type': 'text'
        })
    %}

    {% set options = modify_options(options|default({})) %}

    {{ form.text(options) }}

{% endspaceless %}
{% endmacro %}


{# -----------------------------------------------------------------------------

# Compound

Allows you to build a form group using multiple separate inputs with a single
common label, and render those in a screenreader-friendly way.

https://jadu.github.io/pulsar/form-helpers/compound

#}
{% macro compound(options) %}
{% spaceless %}
    {% import _self as form %}
    {% import '@pulsar/pulsar/v2/helpers/elem.html.twig' as elem %}
    {% import '@pulsar/pulsar/v2/helpers/util.html.twig' as util %}

    {% set groupClass = 'form__group form__group--compound' %}

    {% if options.error is defined and options.error is not empty %}
        {% set groupClass = groupClass ~ ' has-error' %}
    {% endif %}

    {% set options = modify_options(options|default({})) %}

    {# Build aria-described string of guids for help blocks and errors #}
    {% set describedByIds = [] %}

    {% if options.error_ids is defined and options.error_ids is not empty %}
        {% for id in options.error_ids %}
            {% set describedByIds = describedByIds|merge([id]) %}
        {% endfor %}
    {% endif %}

    {% if options.help_id is defined and options.help_id is not empty %}
        {% set describedByIds = describedByIds|merge([options.help_id]) %}
    {% endif %}

    <fieldset{{
        attributes(options
                |only('class id')
                |defaults({ 'class': groupClass })
            )
    -}}>

    <legend class="control__label" {{ util.id(options.id ~ '[label]') }}>{{ options.label|default }} {{ util.guidance(options.guidance|default, { 'guidance-container': options['guidance-container']|default }) }}</legend>

    <div class="controls">
        {% for input in options.inputs %}
            {{
                elem.label(input
                    |only('label guidance-container required show-label')
                    |merge({
                        'for': input.id,
                        'id': input.id ~ '[label]'
                    })
                )
            }}

            {% set inputOptions = input|exclude('error label guidance-container required show-label')|merge({'aria-describedby': describedByIds|join(' ')}) %}

            {% if input.type == 'select' %}
                {{ elem.select(inputOptions|merge({'class': inputOptions.class|default ~ ' select'})) }}
            {% elseif input.type == 'select2' %}
                {{ elem.select2(inputOptions) }}
            {% elseif input.type == 'textarea' %}
                {{ elem.textarea(inputOptions) }}
            {% else %}
                {{ elem.input(inputOptions) }}
            {% endif %}
        {% endfor %}

        {% if options.error_ids is defined and options.error_ids is not empty %}
            {{ form.error({ 'value': options.error|default, 'error_ids':  options.error_ids }) }}
        {% else %}
            {{ form.error({ 'value': options.error|default }) }}
        {% endif %}

        {% if options.help is defined and options.help is not empty %}
            {{ form.help({ 'value': options.help|default, 'id': options.help_id }) }}
        {% endif %}
    </div>
</fieldset>

{% endspaceless %}
{% endmacro %}


{# -----------------------------------------------------------------------------

# Content

Generates a paragraph of text where an input would normally be positioned within
a form while still allowing a regular form label to illustrate it.

Useful for presenting non-editable information within a form where you'd prefer
not to use a disabled input.

## Example usage

```twig
{{
    form.content({
        'label': 'It’s the remix to ignition',
        'value': 'Hot and fresh out the kitchen'
    })
}}
```

## Options applied to parent wrapper

Option      | Type   | Description
----------- | ------ | ---------------------------------------------------------
class       | string | A space separated list of class names
error       | string | Text to explain an error/validation condition. Also adds error state styling
guidance    | string | Text to be displayed in a popover, adds a (?) icon after the input
help        | string | Additional guidance information to be displayed next to the input
label       | string | Text for the `<label>` companion element
raw         | bool   | Instead of wrapping the value in a `<p>`, just render the value/helper instead (default: false)
show-label  | bool   | Control visibility of the `<label>` element without affecting layout (default: true)

## Options applied to paragraph

Option      | Type   | Description
----------- | ------ | ---------------------------------------------------------
id          | string | A unique identifier, will also be used as the label's `for` attribute
value       | string | Specifies the value of the input
data-*      | string | Data attributes, eg: `'data-foo': 'bar'`

*Any other options not listed here will be applied to the paragraph.

#}
{% macro content(options) %}
{% spaceless %}
    {% import _self as form %}
    {% import '@pulsar/pulsar/v2/helpers/elem.html.twig' as elem %}

    {% if options.raw is defined and options.raw == true %}
        {% set input = options.value %}
    {% else %}
        {% set input = elem.paragraph(options|exclude('bare class error guidance guidance-container help label show-label')) %}
    {% endif %}

    {{
        form.group({
            'parent': options|only('bare class error guidance guidance-container help id label show-label'),
            'inputs': [input]
        })
    }}

{% endspaceless %}
{% endmacro %}


{# -----------------------------------------------------------------------------

# Create

Creates the opening `<form>` element.

## Example usage

```twig
{{ form.create() }}
```

## Options

Option  | Type   | Description
------- | ------ | -------------------------------------------------------------
action  | string | URL to post to, will submit to self if empty
class   | string | A space separated list of class names
enctype | string | How the form-data should be encoded (requires method = POST)
id      | string | A unique identifier, if required
name    | string | The name of the form
method  | string | The HTTP method to be used to submit the form
nonce   | string | Random string used to prevent CSRF, adds a hidden `nonce` input after `<form>`
data-*  | string | Data attributes, eg: `'data-foo': 'bar'`

## Enctype

The `enctype` attribute will be set to `application/x-www-form-urlencoded` by
default, unless you’re using a `method` other than `POST`.

##### Example

```twig
{{ form.create() }}
```

```html
<form method="POST" enctype="application/x-www-form-urlencoded" class="form">
```

## Using non-standard RESTful methods

As well as the usual `GET` and `POST` methods, you may also specify the
following:

`DELETE`, `PATCH` or `PUT`

These will then cause a hidden `<input name="_method" value="{{ method }}" />`
to be created automatically after the `<form>` element, and the `method`
attribute on the `form` element will be set to `POST`.

#}
{% macro create(options) %}
{% spaceless %}
    {% import '@pulsar/pulsar/v2/helpers/form.html.twig' as form %}
    {% import '@pulsar/pulsar/v2/helpers/util.html.twig' as util %}

    {% set defaults = {'class': 'form'} %}
    {% set alternateMethods = ['DELETE', 'PATCH', 'PUT'] %}

    {% if options.method is defined and options.method|upper in alternateMethods %}
        {% set methodInput = form.hidden({'name': '_method', 'value': options.method|upper}) %}
    {% endif %}

    {%
        if options.method is not defined
        or options.method is empty
        or options.method|upper in alternateMethods
    %}
        {% set options = options|default({})|merge({'method': 'POST'}) %}
    {% endif %}

    {%
        if options.method is defined
        and options.method is not empty
        and (options.method|upper == 'POST')
    %}
        {% set options = options|merge({'enctype': options.enctype|default('application/x-www-form-urlencoded')}) %}
    {% endif %}

    <form{{ attributes(options|defaults(defaults)|exclude('nonce')) }}>

    {% if options.nonce is defined and options.nonce is not empty %}
        {{ form.hidden({'name': 'nonce', 'value': options.nonce}) }}
    {% endif %}

    {{ methodInput|default }}

{% endspaceless %}
{% endmacro %}


{# -----------------------------------------------------------------------------

# Date

Generates a text input field which will show a date picker when focused.

## Example usage

```twig
{{
    form.date({
        'format': 'US',
        'label': 'When is your birthday?'
    })
}}
```

## Options applied to parent wrapper

Option      | Type   | Description
----------- | ------ | ---------------------------------------------------------
autofocus   | bool   | Whether the field should have input focus on page load
class       | string | A space separated list of class names
error       | string | Text to explain an error/validation condition. Also adds error state styling
guidance    | string | Text to be displayed in a popover, adds a (?) icon after the input
help        | string | Additional guidance information to be displayed next to the input
label       | string | Text for the `<label>` companion element
required    | bool   | Visually indicates that the field must be completed
show-label  | bool   | Control visibility of the `<label>` element without affecting layout (default: true)

## Options applied to input

Option      | Type   | Description
----------- | ------ | ---------------------------------------------------------
autofocus   | bool   | Whether the field should have input focus on page load
disabled    | bool   | Stops the element from being interactive if true
form        | string | Specific one or more forms this label belongs to
format      | string | Options for this can be `default`, `US` or `reverse`
id          | string | A unique identifier, will also be used as the label's `for` attribute
name        | string | The name of this control
placeholder | string | A short hint that describes the expected value
required    | bool   | Adds `required` and `aria-required="true"` attributes
value       | string | Specifies the value of the input
data-*      | string | Data attributes, eg: `'data-foo': 'bar'`

*Any other options not listed here will be applied to the input.

#}
{% macro date(options) %}
{% spaceless %}
    {% import _self as form %}

    {%
        set options = options|default({})|merge({
            'placeholder': options.placeholder|default('dd/mm/yyyy'),
            'data-datepicker': options['data-datepicker']|default('true'),
            'data-format': options.format|default('default')
        })
    %}

    {% set options = modify_options(options|default({})) %}

    {{ form.text(options) }}

{% endspaceless %}
{% endmacro %}


{# -----------------------------------------------------------------------------

# End

Used in conjunction with `form.start()` and allows you to specify the buttons
required to submit/cancel the form, then closes the form with the `</form>`
element.

## Example usage

```twig
{{
    form.end({
        'actions': [
            form.submit({
                'label': 'Sign In'
            }),
            html.link({
                'label': 'Cancel',
                'href': '/home'
            })
        ]
    })
}}
```

## Options

Option  | Type   | Description
------- | ------ | -------------------------------------------------------------
actions | array  | Helpers to display as the actions, usually `form.submit()` but can be buttons, links etc...
class   | string | A space separated list of class names

#}
{% macro end(options) %}
    {% import '@pulsar/pulsar/v2/helpers/util.html.twig' as util %}

    {% if options.actions is defined %}
        <div{{
            attributes(options
                |exclude('actions')
                |defaults({
                    'class': 'form__actions'
                })
            )
        }}>
            {% for action in options.actions %}
                {{ action|raw }}
            {% endfor %}
        </div>
    {% endif %}
    </form>
{% endmacro %}


{# -----------------------------------------------------------------------------

# Error

Error text to be displayed with a form control, normally called by
the `form.group()` helper and not really intended to be called directly from a
view.

## Example usage

```twig
{{
    form.errors({
        'value': 'Something went wrong'
    })
}}
```

or

```twig
{{
    form.errors({
        'value': ['Something went wrong', 'This'
    })
}}
```

## Options

Option | Type           | Description
------ | -------------- | ------------------------------------------------------
value  | string, array  | The string, or array of strings to render inside the error block

#}
{% macro error(options) %}
{% import '@pulsar/pulsar/v2/helpers/html.html.twig' as html %}
{% spaceless %}
    {% if options.value is defined and options.value is not empty %}
        {% if options.value is not iterable %}
            {% set errors = [options.value] %}
        {% else %}
            {% set errors = options.value %}
        {% endif %}

        {% if options.error_ids is defined and options.error_ids is not empty %}
            {% for error in errors %}
                <span class="help-block is-error" id="{{ attribute(options.error_ids, loop.index0) }}">
                    {{ html.icon('warning-sign') }} {{ error|raw -}}
                </span>
            {% endfor %}
        {% else %}
            {% for error in errors %}
                <span class="help-block is-error">
                    {{ html.icon('warning-sign') }} {{ error|raw -}}
                </span>
            {% endfor %}
        {% endif %}
    {% endif %}
{% endspaceless %}
{% endmacro %}


{# -----------------------------------------------------------------------------

# Fieldset start

Opens a `<fieldset>` and allows you to define an optional `<legend>`.

## Example usage

```twig
{{
    form.fieldset_start({
        'legend': 'I am Legend'
    })
}}
```

## Options

Option | Type   | Description
------ | ------ | --------------------------------------------------------------
class  | string | A space separated list of class names
form   | string | Specific one or more forms the fieldset belongs to
id     | string | A unique identifier, if required
legend | string | Label for the optional legend element
name   | string | The name of this control
data-* | string | Data attributes, eg: `'data-foo': 'bar'`

#}
{% macro fieldset_start(options) %}
{% spaceless %}
    {% import '@pulsar/pulsar/v2/helpers/util.html.twig' as util %}

    <fieldset{{ attributes(options|exclude('legend')) }}>
    {%
        if options.legend is defined
        and options.legend is not empty
    %}
        <legend class="legend">{{ options.legend|raw }}</legend>
    {% endif %}

{% endspaceless %}
{% endmacro %}


{# -----------------------------------------------------------------------------

# Fieldset end

Used in conjunction with `fieldset.start()` and closes the `<fieldset>`.

## Example usage

```twig
{{ form.fieldset_end() }}
```

#}
{% macro fieldset_end() %}
{% spaceless %}

    </fieldset>

{% endspaceless %}
{% endmacro %}


{# -----------------------------------------------------------------------------

# File

Generates a file input.

## Example usage

```twig
{{
    form.file({
        'label': 'Send us a pretty picture'
    })
}}
```

## Options applied to parent wrapper

Option      | Type   | Description
----------- | ------ | ---------------------------------------------------------
class       | string | A space separated list of class names
error       | string | Text to explain an error/validation condition. Also adds error state styling
guidance    | string | Text to be displayed in a popover, adds a (?) icon after the input
help        | string | Additional guidance information to be displayed next to the input
label       | string  | Text for the `<label>` companion element
required    | bool   | Visually indicates that the field must be completed
show-label  | bool   | Control visibility of the `<label>` element without affecting layout (default: true)

## Options applied to input

Option      | Type   | Description
----------- | ------ | ---------------------------------------------------------
autofocus   | bool   | Whether the field should have input focus on page load
disabled    | bool   | Stops the element from being interactive if true
form        | string | Specific one or more forms this label belongs to
id          | string | A unique identifier, will also be used as the label's `for` attribute
name        | string | The name of this control
placeholder | string | A short hint that describes the expected value
required    | bool   | Adds `required` and `aria-required="true"` attributes
value       | string | Specifies the value of the input
data-*      | string | Data attributes, eg: `'data-foo': 'bar'`

*Any other options not listed here will be applied to the input.
*
#}
{% macro file(options) %}
{% spaceless %}
    {% import _self as form %}
    {% import '@pulsar/pulsar/v2/helpers/elem.html.twig' as elem %}

    {% set options = modify_options(options|default({})) %}

    {{
        form.group({
            'parent': options|only('bare class error error_ids guidance guidance-container help help_id id label required show-label'),
            'inputs': [
                elem.input(options
                    |exclude('bare class guidance guidance-container error help label show-label')
                    |defaults({'type': 'file'})
                    |merge({'class': 'file'})
                )
            ]
        })
    }}

{% endspaceless %}
{% endmacro %}

{# -----------------------------------------------------------------------------

# Group

This is a constructor macro which generates an input field wrapped with
standard markup with the ability to prepend/append extra elements. It is called
by other macros like form.text and form.password.

```html
<div class="panel panel--info">
    <div class="panel__title">
        <i class="icon-info-sign"></i> Info
    </div>
    <div class="panel__body">
        <p>This helper is not really intended to be called directly from a
        view</p>
    </div>
</div>
```

Usually, you’ll have a single `options` hash to this You need to specify which
of the options you want to apply to the parent wrapper (usually a `<div>`) and
which you want to be attached to the actual form input element. Use the `only`
and `exclude` array functions to manipulate your options array.

## Example usage

```twig
{{
    form.group({
        'parent': options|only('class label help')
        'inputs': [
            elem.input(options
                |exclude('class label help')
            )
        ]
    })
}}
```

In this example, if `'class': 'FOO'`, `'label': 'BAR'` and `'help': 'BAZ'` will
be placed in the markup like so:

```html
<div class="form__group FOO">
    <label for="inputText" class="control__label">BAR</label>
    <div class="controls">
        <input id="inputText" name="inputText" placeholder="Placeholder"
            type="text" class="form__control">
        <p class="help-block">BAZ</p>
    </div>
</div>
```

## Options

Option | Type  | Description
------ | ----- | ---------------------------------------------------------------
parent | hash  | options to be applied to the parent wrapper
inputs | array | an array of inputs

## Options applied to the parent wrapper

Option            | Type   | Description
----------------- | ------ | ----------------------------------------------------
parent.append     | string | Content to display after the input, usually short text or icons
parent.class      | string | A space separated list of class names
parent.error      | string | Text to explain an error/validation condition. Also adds error state styling
parent.guidance   | string | Text to be displayed in a popover, adds a (?) icon after the input
parent.id         | string | A unique identifier, will also be used as the label's `for` attribute
parent.help       | string | Additional guidance information to be displayed next to the input
parent.inputs     | array  | One or more form inputs to display
parent.label      | string | Text for the `<label>` companion element
parent.prepend    | string | Content to display before the input, usually short text or icons
parent.removable  | bool   | Whether to display a remove button after the input (default false)
parent.required   | bool   | Visually indicates that the field must be completed
parent.show-label | bool   | Control visibility of the `<label>` element without affecting layout (default: true)
parent.data-*     | string | Data attributes, eg: `'data-foo': 'bar'`

## Options applied to the controls wrapper

Option            | Type   | Description
----------------- | ------ | ----------------------------------------------------
controls.class    | string | A space separated list of class names

#}
{% macro group(options) %}

    {% import _self as form %}
    {% import '@pulsar/pulsar/v2/helpers/util.html.twig' as util %}
    {% import '@pulsar/pulsar/v2/helpers/elem.html.twig' as elem %}
    {% import '@pulsar/pulsar/v2/helpers/html.html.twig' as html %}

    {% set groupClass = 'form__group' %}

    {% if options.parent.error is defined and options.parent.error is not empty %}
        {% set groupClass = groupClass ~ ' has-error' %}
    {% endif %}

    {% if options.parent.label is defined and options.parent.label is null %}
        {% set groupClass = groupClass ~ ' form__group--no-label' %}
    {% endif %}

    {% set showLabel = true %}
    {% if options.parent['show-label'] is defined and options.parent['show-label'] == false %}
        {% set showLabel = false %}
    {% endif %}

    {% set isToggleSwitch = false %}
    {% if options.parent.class is defined and 'form__group--toggle' in options.parent.class %}
        {% set isToggleSwitch = true %}
    {% endif %}

    {% if options.parent.bare is not defined or options.parent.bare != true %}
    <div{{
        attributes(options.parent
                |only('class aria-describedby')
                |defaults({
                    'class': groupClass
                })
            )
    -}}>
    {% endif %}

        {% if isToggleSwitch %}
        <label class="toggle-switch-wrapper-label"{% if options.parent.id is defined and options.parent.id is not empty %} for="{{ options.parent.id }}"{% endif %}>
        {% endif %}

        {{
            elem.label({
                'for': options.parent.id|default,
                'guidance': options.parent.guidance|default,
                'label': options.parent.label|default,
                'show-label': showLabel,
                'required': options.parent.required|default,
                'guidance-container': options.parent['guidance-container']|default,
                'tag': (isToggleSwitch) ? 'span' : 'label'
            })
        }}

        {% if options.parent.bare is not defined or options.parent.bare != true %}
            <{{ attributes(options|defaults({
                'class': 'controls ' ~ (options.controls.class is defined ? options.controls.class)
            }), {'tag': ((isToggleSwitch) ? 'span' : 'div')}) }}>
        {% endif %}

        {% set input_group_classes = '' %}

        {% if options.parent.removable is defined and options.parent.removable == true %}
            {% set input_group = true %}
            {% set input_group_classes = input_group_classes ~ ' is-removable' %}
        {% endif %}

        {% if (options.parent.prepend_type is defined and options.parent.prepend_type == 'button') %}
            {% set input_group_classes = input_group_classes ~ ' has-btn-prepended' %}
        {% endif %}

        {% if (options.parent.append_type is defined and options.parent.append_type == 'button') %}
            {% set input_group_classes = input_group_classes ~ ' has-btn-appended' %}
        {% endif %}

        {%
            if (options.parent.prepend is defined and options.parent.prepend is not empty)
            or (options.parent.append is defined and options.parent.append is not empty)
        %}
            <div class="input-group{{ input_group_classes }}">

            {% if (options.parent.prepend_type is defined and options.parent.prepend_type == 'button') %}
                <span class="input-group-btn">
                    {{ util.addon(options.parent.prepend|default) }}
                </span>
            {% elseif options.parent.prepend is defined and options.parent.prepend is not empty %}
                <span class="input-group-addon">
                    {{ util.addon(options.parent.prepend|default) }}
                </span>
            {% endif %}
        {% endif %}

        {# input #}
        {% for input in options.inputs %}
            {% if input is iterable %}
                {% if options.parent.type is defined and options.parent.type is not empty %}
                    {% if options.parent.type == 'radio' %}
                        {{- form.radio_simple(input) -}}
                    {% elseif options.parent.type == 'checkbox' %}
                        {{- form.checkbox_simple(input) -}}
                    {% elseif options.parent.type == 'button' %}
                        {{- html.button(input) -}}
                    {% endif %}
                {% else %}
                    {{- form.radio_simple(input) -}}
                {% endif %}
            {% else %}
                {{- input|raw -}}
            {% endif %}
        {% endfor %}

            {% if options.parent.append is defined and options.parent.append is not empty %}

                {% if (options.parent.append_type is defined and options.parent.append_type == 'button') %}
                    <span class="input-group-btn">
                        {{ util.addon(options.parent.append|default) }}
                    </span>
                {% elseif options.parent.append is defined and options.parent.append is not empty %}
                    <span class="input-group-addon">
                        {{ util.addon(options.parent.append|default) }}
                    </span>
                {% endif %}
            {% endif %}

        {%
            if (options.parent.prepend is defined and options.parent.prepend is not empty)
            or (options.parent.append is defined and options.parent.append is not empty)
        %}
            </div>
        {% endif %}

        {% if options.parent.removable is defined and options.parent.removable == true %}
                {{ html.remove_button({ 'target': options.parent.id|default }) }}
            </div>
        {% endif %}

        {% if options.parent.error_ids is defined and options.parent.error_ids is not empty %}
            {{ form.error({ 'value': options.parent.error|default, 'error_ids':  options.parent.error_ids }) }}
        {% else %}
            {{ form.error({ 'value': options.parent.error|default }) }}
        {% endif %}

        {% if isToggleSwitch %}
            {% if options.parent.help is defined and options.parent.help is not empty %}
                {{ form.help({ 'value': options.parent.help|default }) }}
            {% endif %}
        {% else %}
            {% if options.parent.help is defined and options.parent.help is not empty and options.parent.help_id is defined and options.parent.help_id is not empty %}
                {{ form.help({ 'value': options.parent.help|default, 'id': options.parent.help_id }) }}
            {% endif %}
        {% endif %}

        {% if options.parent.bare is not defined or options.parent.bare != true %}
            </{{ (isToggleSwitch) ? 'span' : 'div' }}>
        {% endif %}

        {% if isToggleSwitch %}
        </label>
        {% endif %}
    {% if options.parent.bare is not defined or options.parent.bare != true %}
    </div>
    {% endif %}

{% endmacro %}


{# -----------------------------------------------------------------------------

# Help

Additional guidance text to be displayed with a form control, normally called by
the `form.group()` helper and not really intended to be called directly from a
view.

## Example usage

```twig
{{
    form.help({
        'value': 'Your password'
    })
}}
```

## Options

Option | Type   | Description
------ | ------ | ---------------------------------------------------------
value  | string | The string or html markup to render inside the help block

#}
{% macro help(options) %}
{% spaceless %}

    {% if options.value is defined and options.value is not empty %}
        <span class="help-block"{% if options.id is defined and options.id is not empty %} id="{{- options.id -}}"{% endif %}>
            {{- options.value|raw -}}
        </span>
    {% endif %}

{% endspaceless %}
{% endmacro %}


{# -----------------------------------------------------------------------------

# Hidden

Generates a hidden text input which can be used to store non user-editable data.

All presentational markup and classes will be removed from this input to prevent
it from affecting a form's layout.

## Example usage

```twig
{{
    form.hidden({
        'value': 'Shh, you can’t see me...'
    })
}}
```

## Options applied to input

Option      | Type   | Description
----------- | ------ | ---------------------------------------------------------
disabled    | bool   | Stops the element from being interactive if true
form        | string | Specific one or more forms this label belongs to
id          | string | A unique identifier, will also be used as the label's `for` attribute
name        | string | The name of this control
value       | string | Specifies the value of the input
data-*      | string | Data attributes, eg: `'data-foo': 'bar'`

#}
{% macro hidden(options) %}
{% spaceless %}
    {% import '@pulsar/pulsar/v2/helpers/elem.html.twig' as elem %}

    {{
        elem.input(options
            |exclude('class help label')
            |merge({
                'type': 'hidden',
                'naked': true
            })
        )
    }}

{% endspaceless %}
{% endmacro %}


{# -----------------------------------------------------------------------------

# Password

Generates a password input field.

## Example usage

```twig
{{
    form.password({
        'label': 'Your password',
        'id': 'example-password'
    })
}}
```

## Options applied to parent wrapper

Option      | Type   | Description
----------- | ------ | ---------------------------------------------------------
append      | string | Text or markup to include after the input element
class       | string | A space separated list of class names
error       | string | Text to explain an error/validation condition. Also adds error state styling
guidance    | string | Text to be displayed in a popover, adds a (?) icon after the input
help        | string | Additional guidance information to be displayed next to the input
label       | string | Text for the `<label>` companion element
prepend     | string | Text or markup to include before the input element
required    | bool   | Visually indicates that the field must be completed
show-label  | bool   | Control visibility of the `<label>` element without affecting layout (default: true)

## Options applied to input

Option      | Type   | Description
----------- | ------ | ---------------------------------------------------------
autofocus   | bool   | Whether the field should have input focus on page load
disabled    | bool   | Stops the element from being interactive if true
form        | string | Specific one or more forms this label belongs to
id          | string | A unique identifier, will also be used as the label's `for` attribute
name        | string | The name of this control
placeholder | string | A short hint that describes the expected value
required    | bool   | Adds `required` and `aria-required="true"` attributes
value       | string | Specifies the value of the input
data-*      | string | Data attributes, eg: `'data-foo': 'bar'`

*Any other options not listed here will be applied to the input.

#}
{% macro password(options) %}
{% spaceless %}
    {% import _self as form %}

    {{ form.text(options|defaults({'type': 'password'})) }}

{% endspaceless %}
{% endmacro %}


{# -----------------------------------------------------------------------------

# Radio

Generates a radio input field.

## Example usage

```twig
{{
    form.radio({
        'label': 'GaGa',
        'id': 'example-radio'
    })
}}
```

## Options applied to parent wrapper

Option     | Type   | Description
---------- | ------ | ------------------------------------------------------------
class      | string | A space separated list of class names
error      | string | Text to explain an error/validation condition. Also adds error state styling
guidance   | string | Text to be displayed in a popover, adds a (?) icon after the input
help       | string | Additional guidance information to be displayed next to the input
label      | string | Text for the `<label>` companion element
required   | bool   | Visually indicates that the field must be completed
show-label | bool   | Control visibility of the `<label>` element without affecting layout (default: true)

## Options applied to input

Option     | Type   | Description
---------- | ------ | ------------------------------------------------------------
form       | string | Specific one or more forms this label belongs to
id         | string | A unique identifier, will also be used as the label's `for` attribute
name       | string | The name of this control
required   | bool   | Adds `required` and `aria-required="true"` attributes
selected   | bool   | Whether the input is checked
value      | string | Specifies the value of the input
data-*     | string | Data attributes, eg: `'data-foo': 'bar'`

*Any other options not listed here will be applied to the input.

#}
{% macro radio(options) %}
{% spaceless %}
    {% import _self as form %}
    {% import '@pulsar/pulsar/v2/helpers/elem.html.twig' as elem %}

    {% set options = modify_options(options|default({})) %}

    {{
        form.group({
            'parent': options
                |only('bare class error error_ids guidance guidance-container help help_id id label required show-label')
                |defaults({
                    'class': 'form-radio'
                }),
            'inputs': [
                elem.input(options
                    |exclude('bare class error guidance guidance-container help label show-label')
                    |defaults({
                        'class': 'radio',
                        'type': 'radio'
                    })
                )
            ]
        })
    }}

{% endspaceless %}
{% endmacro %}


{# -----------------------------------------------------------------------------

# Radio inline

Creates a `<label>` element with a radio input inside it and allows the radio to
be positioned either before or after the label value.

## Example usage

```twig
{{
    form.radio_inline({
        'label': 'Inline radio example',
        'id': 'example-radio-inline'
    })
}}
```

## Options applied to parent wrapper

Option          | Type   | Description
--------------- | ------ | -----------------------------------------------------
class           | string | A space separated list of class names
error           | string | Text to explain an error/validation condition. Also adds error state styling
guidance        | string | Text to be displayed in a popover, adds a (?) icon after the input
help            | string | Additional guidance information to be displayed next to the input
required        | bool   | Visually indicates that the field must be completed

## Options applied to input

Option          | Type   | Description
--------------- | ------ | -----------------------------------------------------
form            | string | Specific one or more forms this label belongs to
id              | string | A unique identifier, will also be used as the label's `for` attribute
label           | string | Text for the `<label>` companion element
input_placement | string | `left` (default), `right` position of the input vs the label value
name            | string | The name of this control
required        | bool   | Adds `required` and `aria-required="true"` attributes
selected        | bool   | Whether this radio button should be selected
value           | string | Specifies the value of the input
data-*          | string | Data attributes, eg: `'data-foo': 'bar'`

*Any other options not listed here will be applied to the input

#}
{% macro radio_inline(options) %}
{% spaceless %}
    {% import _self as form %}
    {% import '@pulsar/pulsar/v2/helpers/elem.html.twig' as elem %}

    {% set options = modify_options(options|default({})) %}

    {% set inputClass = 'radio' %}
    {%
        if options.bare is defined
        and options.bare
        and options.class is defined
        and options.class is not empty
    %}
        {% set inputClass = inputClass ~ ' ' ~ options.class %}
    {% endif %}

    {%
        set input = elem.input(options
            |exclude('error guidance guidance-container help')
            |merge({
                'class': inputClass,
                'label': null,
                'type': 'radio'
            })
        )
    %}

    {% set label = input ~ options.label %}

    {%
        if options.input_placement is defined
        and options.input_placement == 'right'
    %}
        {% set label = options.label ~ input %}
    {% endif %}

    {{
        form.group({
            'parent': options
                |only('bare class error error_ids guidance-container help help_id id')
                |defaults({
                    'class': 'form-radio-inline'
                }),
            'inputs': [
                elem.label({
                    'for': options.id|default,
                    'label': label,
                    'required': options.required|default,
                    'required-indicator': options['required-indicator']|default,
                    'guidance': options.guidance|default,
                    'guidance-container': options['guidance-container']|default
                })
            ]
        })
    }}

{% endspaceless %}
{% endmacro %}


{# -----------------------------------------------------------------------------

# Radio Simple

Creates a radio input with a sibling label element, this allows other macros
like `form.button_group()` to use the input’s `:checked` state to modify the
label through the use of the sibling `+` CSS selector.

## Example usage

```twig
{{
    form.radio_simple({
        'label': 'Foo',
        'name': 'foo_group',
        'id': 'foo'
    })
}}
```

## Example output

```html
<input type="radio" name="bar" id="baz" /><label for="baz">Foo</label>
```

## Options applied to input

Option   | Type   | Description
-------- | ------ | ------------------------------------------------------------
form     | string | Specific one or more forms this label belongs to
help     | string | Additional guidance information to be displayed next to the input
id       | string | A unique identifier, will also be used as the label's `for` attribute
name     | string | The name of this control
required | bool   | Adds `required` and `aria-required="true"` attributes
selected | bool   | Whether this radio button should be selected
value    | string | Specifies the value of the input
data-*   | string | Data attributes, eg: `'data-foo': 'bar'`

## Options applied to label

Option   | Type   | Description
-------- | ------ | ------------------------------------------------------------
class    | string | A space separated list of class names
label    | string | Text for the `<label>` companion element
required | bool   | Visually indicates that the field must be completed

*Any other options not listed here will be applied to the input

#}
{% macro radio_simple(options) %}
{% spaceless %}
    {% import '@pulsar/pulsar/v2/helpers/elem.html.twig' as elem %}

    {{
        elem.input(options
            |exclude('class for guidance-container label show-label')
            |defaults({
                'type': 'radio'
            })
			|merge({'class': 'radio'})
        )
    }}
    {{
        elem.label(options
            |only('class label for guidance-container required show-label')
            |defaults({'for': options.id|default})
        )
    }}

{% endspaceless %}
{% endmacro %}


{# -----------------------------------------------------------------------------

# Range

Generates a range input field.

## Example usage

```twig
{{
    form.range({
        'label': 'Width',
        'id': 'example-range'
    })
}}
```

## Options applied to parent wrapper

Option      | Type   | Description
----------- | ------ | ---------------------------------------------------------
append      | string | Text or markup to include after the input element
class       | string | A space separated list of class names
error       | string | Text to explain an error/validation condition. Also adds error state styling
guidance    | string | Text to be displayed in a popover, adds a (?) icon after the input
help        | string | Additional guidance information to be displayed next to the input
label       | string | Text for the `<label>` companion element
prepend     | string | Text or markup to include before the input element
required    | bool   | Visually indicates that the field must be completed
show-label  | bool   | Control visibility of the `<label>` element without affecting layout (default: true)

## Options applied to input

Option      | Type   | Description
----------- | ------ | ---------------------------------------------------------
autofocus   | bool   | Whether the field should have input focus on page load
disabled    | bool   | Stops the element from being interactive if true
form        | string | Specific one or more forms this label belongs to
id          | string | A unique identifier, will also be used as the label's `for` attribute
name        | string | The name of this control
required    | bool   | Adds `required` and `aria-required="true"` attributes
value       | string | Specifies the value of the input
data-*      | string | Data attributes, eg: `'data-foo': 'bar'`

*Any other options not listed here will be applied to the input.

#}
{% macro range(options) %}
{% spaceless %}
    {% import _self as form %}

    {{ form.text(options|defaults({'type': 'range', 'class': 'form-range'})) }}

{% endspaceless %}
{% endmacro %}


{# -----------------------------------------------------------------------------

# Select

Generates a select input.

## Example usage

```twig
{{
    form.select({
        'label': 'Pick a colour',
        'id': 'example-select',
        'options': {
            '': 'Choose',
            'colour_red': 'Red',
            'colour_blue': 'Blue'
        }
    })
}}
```

## Options applied to parent wrapper

Option      | Type   | Description
----------- | ------ | --------------------------------------------------------
class       | string | A space separated list of class names
error       | string | Text to explain an error/validation condition. Also adds error state styling
guidance    | string | Text to be displayed in a popover, adds a (?) icon after the input
help        | string | Additional guidance information to be displayed next to the input
label       | string | Text for the `<label>` companion element
required    | bool   | Visually indicates that the field must be completed
show-label  | bool   | Control visibility of the `<label>` element without affecting layout (default: true)

## Options applied to the input

Option      | Type   | Description
----------- | ------ | --------------------------------------------------------
form        | string | Specific one or more forms this label belongs to
id          | string | A unique identifier, will also be used as the label's `for` attribute
multiple    | bool   | Whether multiple options can be selected
name        | string | The name of this control
options     | hash   | The `<option>` attributes formatted as `{ 'value': 'label' }`
required    | bool   | Adds `required` and `aria-required="true"` attributes
selected    | string | The `id` of the item in `options` that should be initially selected
size        | int    | The number of items to display when the list is shown
data-*      | string | Data attributes, eg: `'data-foo': 'bar'`

*Any other options not listed here will be applied to the input.

#}
{% macro select(options) %}
{% spaceless %}
    {% import _self as form %}
    {% import '@pulsar/pulsar/v2/helpers/elem.html.twig' as elem %}

    {% set options = modify_options(options|default({})) %}

    {{
        form.group({
            'parent': options|only('append append_type bare class error error_ids guidance guidance-container help help_id id label prepend prepend_type required show-label'),
            'inputs': [
                elem.select(
                    options
					|exclude('bare class error guidance guidance-container help label show-label')
					|merge({'class': 'select'})
                )
            ]
        })
    }}

{% endspaceless %}
{% endmacro %}


{# -----------------------------------------------------------------------------

# Select2

Generates a select input using the select2 plugin (https://select2.github.io).

## Example usage

```twig
{{
    form.select2({
        'label': 'Pick a colour',
        'id': 'example-select',
        'options': {
            '': 'Choose',
            'colour_red': 'Red',
            'colour_blue': 'Blue'
        }
    })
}}
```

## Options applied to parent wrapper

Option      | Type   | Description
----------- | ------ | --------------------------------------------------------
class       | string | A space separated list of class names
error       | string | Text to explain an error/validation condition. Also adds error state styling
guidance    | string | Text to be displayed in a popover, adds a (?) icon after the input
help        | string | Additional guidance information to be displayed next to the input
label       | string | Text for the `<label>` companion element
required    | bool   | Visually indicates that the field must be completed
show-label  | bool   | Control visibility of the `<label>` element without affecting layout (default: true)

## Options applied to the input

Option      | Type   | Description
----------- | ------ | --------------------------------------------------------
data-html   | string | If `true`, uses Select2's templating functions to parse HTML within options
disabled    | string | Stops the element from being interactive if value = 'disabled'
form        | string | Specific one or more forms this label belongs to
id          | string | A unique identifier, will also be used as the label's `for` attribute
multiple    | bool   | Whether multiple options can be selected
name        | string | The name of this control
options     | hash   | The `<option>` attributes formatted as `{ 'value': 'label' }`
required    | bool   | Adds `required` and `aria-required="true"` attributes
selected    | string | The `id` of the item in `options` that should be initially selected
size        | int    | The number of items to display when the list is shown
data-*      | string | Data attributes, eg: `'data-foo': 'bar'`

*Any other options not listed here will be applied to the input.

#}
{% macro select2(options) %}
{% spaceless %}
    {% import _self as form %}
    {% import '@pulsar/pulsar/v2/helpers/elem.html.twig' as elem %}

    {% set options = modify_options(options|default({})) %}

    {{
        form.group({
            'parent': options|only('append append_type bare class error error_ids guidance guidance-container help help_id id prepend prepend_type label required show-label'),
            'inputs': [
                elem.select2(options
                    |exclude('bare class error guidance guidance-container help label show-label')
                )
            ]
        })
    }}

{% endspaceless %}
{% endmacro %}


{# -----------------------------------------------------------------------------

## Submit

Creates your standard form submit button. Accepts all the same arguments as the
`html.button()` helper.

### Example usage

```twig
{{
    form.submit({
        'label': 'GO GO GO!'
    })
}}
```

### Options

Option   | Type  | Description
-------- | ----- | -------------------------------------------------------------
class   | string | A space separated list of class names
form    | string | Specifies one or more forms this label belongs to
href    | string | URL to use for link button types
id      | string | A unique identifier, will also be used as the label's `for` attribute
name    | string | The name of this control
label   | string | The button label
type    | string | Can be button (default), link, input, submit
data-*  | string | Data attributes, eg: `'data-foo': 'bar'`

*Any other options not listed here will be applied to the input.

#}
{% macro submit(options) %}
{% spaceless %}
    {% import '@pulsar/pulsar/v2/helpers/html.html.twig' as html %}

    {{
        html.button(options|merge({
            'class': options.class|default ~ ' js-submit-disable',
            'type': 'submit'
        }))
    }}

{% endspaceless %}
{% endmacro %}


{# -----------------------------------------------------------------------------

# Text

Generates a text input and passes it to the `group` helper to wrap it in the
required form markup.

## Example usage

```twig
{{
    form.text({
        'label': 'What’s your name, boss?'
    })
}}
```

## Options applied to parent wrapper

Option       | Type   | Description
------------ | ------ | ---------------------------------------------------------
append       | string | Text or markup to include after the input element
append_type  | string | Use only when appending a button. `button` is the only valid value
class        | string | A space separated list of class names
error        | string | Text to explain an error/validation condition. Also adds error state styling
guidance     | string | Text to be displayed in a popover, adds a (?) icon after the input
guidance-container | string | Element to bind guidance popover scroll behaviour to (default `body`)
help         | string | Additional guidance information to be displayed next to the input
id           | string | Passed to the `<label>` element as a `for` attribute, and the `<input>` as the unique identifier
label        | string | Text for the `<label>` companion element
prepend      | string | Text or markup to include before the input element
prepend_type | string | Use only when prepending a button. `button`is the only valid value
required     | bool   | Visually indicates that the field must be completed
show-label   | bool   | Control visibility of the `<label>` element without affecting layout (default: true)

## Options applied to input

Option      | Type   | Description
----------- | ------ | ---------------------------------------------------------
autofocus   | bool   | Whether the field should have input focus on page load
disabled    | bool   | Stops the element from being interactive if true
form        | string | Specific one or more forms this label belongs to
id          | string | A unique identifier, will also be used as the label's `for` attribute
name        | string | The name of this control
placeholder | string | A short hint that describes the expected value
required    | bool   | Adds `required` and `aria-required="true"` attributes
value       | string | Specifies the value of the input
data-*      | string | Data attributes, eg: `'data-foo': 'bar'`

* Any other options not listed here will be applied to the input.

#}
{% macro text(options) %}
{% spaceless %}
    {% import _self as form %}
    {% import '@pulsar/pulsar/v2/helpers/elem.html.twig' as elem %}

    {% set options = options|default({})|merge({ 'type': options.type|default('text') }) %}

    {% set options = modify_options(options|default({})) %}

    {{
        form.group({
            'parent': options|only('append append_type bare class error error_ids guidance guidance-container help help_id id label prepend prepend_type required show-label'),
            'inputs': [
                elem.input(
                    options|exclude('append_type bare class error guidance guidance-container help label prepend_type show-label')
                )
            ]
        })
    }}

{% endspaceless %}
{% endmacro %}


{# -----------------------------------------------------------------------------

# Textarea

Generates a `<textarea>` with options to control the number of rows (the height)
of the element.

## Example usage

```twig
{{
    form.textarea({
        'label': 'What is the meaning of life?'
    })
}}
```

## Options applied to parent wrapper

Option      | Type   | Description
----------- | ------ | ---------------------------------------------------------
class       | string | A space separated list of class names
error       | string | Text to explain an error/validation condition. Also adds error state styling
guidance    | string | Text to be displayed in a popover, adds a (?) icon after the input
help        | string | Additional guidance information to be displayed next to the input
label       | string | Text for the `<label>` companion element
required    | bool   | Visually indicates that the field must be completed
show-label  | bool   | Control visibility of the `<label>` element without affecting layout (default: true)

## Options applied to input

Option      | Type   | Description
----------- | ------ | --------------------------------------------------------
autofocus   | bool   | Whether the field should have input focus on page load
form        | string | Specific one or more forms this label belongs to
id          | string | A unique identifier, will also be used as the label's `for` attribute
name        | string | The name of this control
placeholder | string | A short hint that describes the expected value
required    | bool   | Adds `required` and `aria-required="true"` attributes
rows        | int    | The height, in rows (default 2)
value       | string | Specifies the value of the input
data-*      | string | Data attributes, eg: `'data-foo': 'bar'`

*Any other options not listed here will be applied to the input.

#}
{% macro textarea(options) %}
{% spaceless %}
    {% import _self as form %}
    {% import '@pulsar/pulsar/v2/helpers/elem.html.twig' as elem %}

    {% set options = modify_options(options|default({})) %}

    {{
        form.group({
            'parent': options|only('bare class error error_ids guidance guidance-container help help_id id label required show-label'),
            'inputs': [
                elem.textarea(options
                    |exclude('bare class error guidance guidance-container help label show-label')
                    |merge({'class': 'textarea'})
                )
            ]
        })
    }}

{% endspaceless %}
{% endmacro %}


{# -----------------------------------------------------------------------------

# Time

Generates a text input field which will show a time picker when focused.

## Example usage

```twig
{{
    form.time({
        'label': 'What time would you like your appointment?'
    })
}}
```

## Options applied to parent wrapper

Option      | Type   | Description
----------- | ------ | ---------------------------------------------------------
autofocus   | bool   | Whether the field should have input focus on page load
class       | string | A space separated list of class names
error       | string | Text to explain an error/validation condition. Also adds error state styling
guidance    | string | Text to be displayed in a popover, adds a (?) icon after the input
help        | string | Additional guidance information to be displayed next to the input
label       | string | Text for the `<label>` companion element
required    | bool   | Visually indicates that the field must be completed
show-label  | bool   | Control visibility of the `<label>` element without affecting layout (default: true)

## Options applied to input

Option      | Type   | Description
----------- | ------ | ---------------------------------------------------------
autofocus   | bool   | Whether the field should have input focus on page load
disabled    | bool   | Stops the element from being interactive if true
form        | string | Specific one or more forms this label belongs to
id          | string | A unique identifier, will also be used as the label's `for` attribute
name        | string | The name of this control
placeholder | string | A short hint that describes the expected value
required    | bool   | Adds `required` and `aria-required="true"` attributes
value       | string | Specifies the value of the input
data-*      | string | Data attributes, eg: `'data-foo': 'bar'`

*Any other options not listed here will be applied to the input.

#}
{% macro time(options) %}
{% spaceless %}
    {% import _self as form %}

    {%
        set options = options|default({})|merge({
            'placeholder': options.placeholder|default('hh:mm'),
            'data-timepicker': 'true'
        })
    %}

    {{ form.text(options) }}
{% endspaceless %}
{% endmacro %}


{# -----------------------------------------------------------------------------

# Toggle Switch

Generates a checkbox input field with Toggle styling.

## Example usage

```twig
{{
    form.toggle_switch({
        'label': 'Flip the switch'
    })
}}
```

## Options applied to parent wrapper

Option        | Type   | Description
------------- | ------ | -------------------------------------------------------
class         | string | A space separated list of class names
error         | string | Text to explain an error/validation condition. Also adds error state styling
guidance      | string | Text to be displayed in a popover, adds a (?) icon after the input
help          | string | Additional guidance information to be displayed next to the input
label         | string | Text for the `<label>` companion element
required      | bool   | Visually indicates that the field must be completed
show-label    | bool   | Control visibility of the `<label>` element without affecting layout (default: true)

## Options applied to input

Option        | Type   | Description
------------- | ------ | -------------------------------------------------------
checked       | bool   | Whether the input is checked
form          | string | Specify one or more forms this label belongs to
id            | string | A unique identifier, will also be applied as the label's `for` attribute
indeterminate | bool   | Shows the checkbox as [-], overrides the value of `checked`
name          | string | The name of this control
required      | bool   | Adds `required` and `aria-required="true"` attributes
value         | string | Specifies the value of the input
data-*        | string | Data attributes, eg: `'data-foo': 'bar'`

*Any other options not listed here will be applied to the input.

#}
{% macro toggle_switch(options) %}
{% spaceless %}
    {% import _self as form %}
    {% import '@pulsar/pulsar/v2/helpers/elem.html.twig' as elem %}

    {% set toggleLabel = '<span class="hide">toggle ' ~ options.label ~ '</span>' %}

    {%
        set toggle = elem.input(options
            |exclude('error guidance guidance-container show-label label help')
            |merge({
                'class': 'toggle-switch',
                'type': 'checkbox'
            })
        ) ~ '<span class="toggle-switch-label"></span>'
    %}

    {{
        form.group({
            'parent': options
                |only('bare class error error_ids guidance guidance-container help help_id id label required show-label')
                |merge({
                    'class': options.class|default ~ ' form__group--toggle'
                }),
            'inputs': [toggle]
        })
    }}

{% endspaceless %}
{% endmacro %}

{# -----------------------------------------------------------------------------

# Repeater Start & End

The opening Repeater macro. Additional components can be nested within the repeater_start and repeater_end macros.
The Repeater allows users to define a repeatable set of for fields that can be added, removed & edited.

## Example usage

```twig
{{
    {{ form.repeater_start({
        'label': 'My first repeater',
        'empty': 'You have not added any repeater entries',
        'headings': [
            { name: 'text', label: 'text' }
        ],
        'max-entries': 3,
        'add-new-group-text': 'Add',
        'add-another-group-text': 'Add another'
    }) }}

        {{
            form.text({
                'label': 'text',
                'id': 'repeater-text',
                'name': 'text'
            })
        }}

    {{  form.repeater_end() }}
}}
```

## Options

Option                  | Type   | Description
-------------           | ------ | -------------------------------------------------------
label                   | string | The repeater input label text
empty                   | string | The empty placeholder text when no items have been added
headings                | Array  | An array of heading config objects: { name: string, label: string }
max-entries             | int    | Maximum (inclusive) number of entries that can be added
add-new-group-text      | string | The text content of the add new entry button
add-another-group-text  | string | The text content of the add another new entry button

0#}
{% macro repeater_start(options) %}
{% import '@pulsar/pulsar/v2/helpers/elem.html.twig' as elem %}
{% import '@pulsar/pulsar/v2/helpers/html.html.twig' as html %}
{% import _self as form %}
{% set headingLength = options.headings|length %}
{% spaceless %}
    <div
        class="repeater"
        data-repeater
        data-repeater-add-new-group-text="{{ options['add-new-group-text']|default('Add') }}"
        data-repeater-add-another-group-text="{{ options['add-another-group-text']|default('Add another') }}"
        data-repeater-max-entries="{{ options['max-entries']|default(false) }}"
        data-repeater-preview-colspan="{{ options.headings|length + 1 }}"
    >
        <div class="repeater__saved-data u-display-none" data-repeater-saved-entries-root></div>
        <div class="form__group">
            {{
                elem.label({
                    'label': options.label,
                    'required': options.required|default(false)
                })
            }}
            <div class="controls">
                <table class="table table--full table--horizontal repeatable__table">
                    <thead class="repeater__preview-headings">
                        <tr>
                            {% for heading in options.headings %}
                                <th data-repeater-for-name="{{ heading.name }}">{{ heading.label }}</th>
                            {% endfor %}
                            <th rowspan="1" colspan="1"></th>
                        </tr>
                    </thead>
                    <tbody class="repeater__preview-data" data-repeater-preview-root>
                        <tr class="repeater__empty-placeholder" data-repeater-preview-placeholder>
                            <td colspan="{{ headingLength }}" class="muted">{{ options.empty }}</td>
                            <td class="table__td--align-right table-row__actions"></td>
                        </tr>
                    </tbody>
                    <tfoot>
                    <tr class="repeater__group" data-repeater-new-group>
                        <td class="table__form" colspan="{{ headingLength + 1 }}">
                            <div data-repeater-new-group-controls>

{% endspaceless %}
{% endmacro %}

{% macro repeater_end() %}
{% import '@pulsar/pulsar/v2/helpers/html.html.twig' as html %}
{% spaceless %}
                            </div>
                            <div class="form__actions repeater__group-actions">
                                {{
                                    html.button({
                                        'data-repeater-save-group': 'true',
                                        'label': 'Save',
                                        'class': 'btn--primary repeater__save-group',
                                        'type': 'button'
                                    })
                                }}

                                {{
                                    html.button({
                                        'data-repeater-cancel-save': 'true',
                                        'label': 'Cancel',
                                        'class': 'btn--naked repeater__cancel-group',
                                        'type': 'button'
                                    })
                                }}
                            </div>
                        </td>
                    </tr>
                    </tfoot>
                </table>
                {{
                    html.button({
                        'data-repeater-add-group': 'true',
                        'label': 'Add',
                        'class': 'repeater__add-group',
                        'type': 'button'
                    })
                }}
            </div>
        </div>
    </div>
{% endspaceless %}
{% endmacro %}
